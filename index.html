<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Image Recognition</title>

<!-- TensorFlow & Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f3f3f3;
    text-align: center;
}
.card {
    background: white;
    padding: 20px;
    margin: 50px auto;
    width: 320px;
    border-radius: 10px;
}
button {
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
}
#view canvas, #view img {
    margin-top: 10px;
    max-width: 100%;
}
</style>
</head>

<body>

<div class="card">
    <h2>Image Recognition</h2>

    <button onclick="openCamera()">ðŸ“· Kamera</button><br>

    <input type="file" accept="image/*" onchange="loadImage(event)">

    <div id="view"></div>
    <div id="result"></div>
</div>

<script>
const MODEL_URL = "https://teachablemachine.withgoogle.com/models/XXXXXXX/";

let model, webcam;

async function loadModel() {
    model = await tmImage.load(
        MODEL_URL + "model.json",
        MODEL_URL + "metadata.json"
    );
}
loadModel();

function stopAll() {
    if (webcam) webcam.stop();
}

async function openCamera() {
    stopAll();
    document.getElementById("result").innerHTML = "";

    try {
        webcam = new tmImage.Webcam(200, 200);
        await webcam.setup();   // â† harus dari klik
        await webcam.play();

        const view = document.getElementById("view");
        view.innerHTML = "";
        view.appendChild(webcam.canvas);

        loop();
    } catch (e) {
        alert("Kamera tidak bisa dibuka. Pastikan izin kamera di browser.");
        console.error(e);
    }
}

async function loop() {
    webcam.update();
    await predict(webcam.canvas);
    requestAnimationFrame(loop);
}

async function loadImage(event) {
    stopAll();

    const img = new Image();
    img.src = URL.createObjectURL(event.target.files[0]);

    img.onload = async () => {
        const view = document.getElementById("view");
        view.innerHTML = "";
        view.appendChild(img);
        await predict(img);
    };
}

async function predict(input) {
    const prediction = await model.predict(input);
    let text = "";

    prediction.forEach(p => {
        text += `${p.className}: ${(p.probability * 100).toFixed(2)}%<br>`;
    });

    document.getElementById("result").innerHTML = text;
}
</script>

</body>
</html>
